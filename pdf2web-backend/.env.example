# ===========================================
# PDF2Web AI Weaver - Environment Configuration
# ===========================================
# Copy this file to .env and fill in your values

# ----- Application Settings -----
APP_NAME=PDF2Web AI Weaver
APP_ENV=development
DEBUG=true
SECRET_KEY=your-secret-key-change-in-production

# ----- Server Settings -----
HOST=0.0.0.0
PORT=8000
CORS_ORIGINS=http://localhost:3000,http://localhost:8501

# =============================================
# ERNIE API Configuration (via Novita AI)
# =============================================
# Novita AI provides ERNIE models with $25 free credits
# Get your API key at: https://novita.ai/
#
# ERNIE Models Available on Novita AI:
# ┌─────────────────────────────────────────────────────────────────┐
# │ TEXT MODELS (for theme analysis, HTML generation)               │
# ├─────────────────────────────────────────────────────────────────┤
# │ baidu/ernie-3.5-8k      │ Fast, cheap │ RECOMMENDED for budget  │
# │ baidu/ernie-4.0-8k      │ Better      │ Higher quality          │
# │ baidu/ernie-4.0-8k-preview │ Best     │ Highest quality         │
# └─────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────┐
# │ VISION MODELS (for page image analysis, component detection)    │
# ├─────────────────────────────────────────────────────────────────┤
# │ baidu/ernie-4.0-8k-preview │ Multimodal │ Analyzes images       │
# └─────────────────────────────────────────────────────────────────┘
#
# HOW MULTIPLE MODELS WORK TOGETHER:
# 1. Text Model (ERNIE-3.5): Theme analysis, HTML generation
# 2. Vision Model (ERNIE-4.0): Page image analysis for better detection
#    - Detects tables → suggests chart type (bar/line/pie)
#    - Detects Q&A lists → suggests quiz widget
#    - Detects timelines → suggests timeline widget
#    - Detects locations → suggests map widget
#
# Alternative: Baidu Direct API (requires Baidu registration)
#   URL: https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions

# Primary text model (cost-effective)
ERNIE_MODEL=baidu/ernie-4.5-21B-a3b
ERNIE_API_KEY=your-novita-api-key-here
ERNIE_API_URL=https://api.novita.ai/v3/openai/chat/completions

# Access token (for Baidu direct API only, leave empty for Novita AI)
ERNIE_ACCESS_TOKEN=

# Request timeout in seconds
ERNIE_REQUEST_TIMEOUT=60

# Cost optimization settings (limit tokens to save credits)
ERNIE_MAX_TOKENS=1000
ERNIE_TEMPERATURE=0.7

# =============================================
# ERNIE Vision Model (Multimodal Analysis)
# =============================================
# Vision model analyzes PDF page images for enhanced detection
# This provides MUCH better accuracy for:
#   - Table structure → optimal chart type
#   - Q&A patterns → quiz widget
#   - Timeline layouts → timeline widget
#   - Geographic data → map widget
#
# Set ENABLE_VISION_ANALYSIS=false to disable (saves API credits)
ERNIE_VISION_MODEL=baidu/ernie-4.0-8k-preview
ENABLE_VISION_ANALYSIS=true

# =============================================
# DeepSeek API Configuration (MCP Multi-Model)
# =============================================
# DeepSeek provides an alternative AI model for:
#   - Knowledge graph generation (entity/relationship extraction)
#   - MCP multi-model support
#   - Cost-effective alternative to ERNIE for some tasks
#
# DeepSeek via Novita AI (uses same API key as ERNIE)
DEEPSEEK_API_KEY=your-novita-api-key-here
DEEPSEEK_API_URL=https://api.novita.ai/v3/openai/chat/completions
DEEPSEEK_MODEL=deepseek/deepseek-v3-turbo
ENABLE_KNOWLEDGE_GRAPH=true

# ----- Storage Settings -----
UPLOAD_DIR=./uploads
OUTPUT_DIR=./outputs
TEMP_DIR=./temp
MAX_FILE_SIZE_MB=50

# ----- Privacy / Secure Mode Settings -----
DEFAULT_SECURE_MODE=true
PII_DETECTION_THRESHOLD=0.7
# Comma-separated list of PII types to redact by default
DEFAULT_PII_TYPES=EMAIL_ADDRESS,PHONE_NUMBER,PERSON,US_SSN,CREDIT_CARD

# ----- OCR Settings -----
OCR_LANGUAGE=en
MAX_PAGES=100
IMAGE_DPI=300
OCR_CONFIDENCE_THRESHOLD=0.8

# ----- Co-Design Layer Settings -----
LOW_CONFIDENCE_THRESHOLD=0.8
MAX_BLOCKS_PER_PAGE=50
ENABLE_THEME_SUGGESTIONS=true

# ----- Semantic Injection Settings -----
ENABLE_CHART_SUGGESTIONS=true
ENABLE_QUIZ_SUGGESTIONS=true
ENABLE_CODE_EXECUTION=true
DEFAULT_CHART_TYPE=bar

# ----- GitHub Pages Deployment (Optional) -----
# Users provide their own token via API, but you can set a default
# GITHUB_TOKEN=your-github-personal-access-token

# ----- Logging Settings -----
LOG_LEVEL=INFO
LOG_FORMAT=json
# Set to false in Secure Mode to disable cloud telemetry
ENABLE_TELEMETRY=false

# ----- Rate Limiting -----
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60

# ----- Export Settings -----
EXPORT_CLEANUP_HOURS=24
MAX_EXPORT_SIZE_MB=100

# ----- Plugin Extensibility Settings -----
# Enable plugin system for additional widget types
ENABLE_PLUGINS=true
PLUGINS_DIR=./plugins
# Comma-separated list of enabled plugins (timelines, maps, calendars, etc.)
ENABLED_PLUGINS=charts,quizzes,code_blocks
# Allow custom CSS/JS injection from plugins
ALLOW_PLUGIN_SCRIPTS=true
# Plugin sandbox mode (restricts plugin capabilities)
PLUGIN_SANDBOX_MODE=true

# ----- Audit & Timestamp Settings (Co-Design Layer) -----
# Enable audit logging for Co-Design actions
ENABLE_AUDIT_LOG=true
# Audit log storage location
AUDIT_LOG_DIR=./audit_logs
# Include timestamps in Co-Design UI
ENABLE_ACTION_TIMESTAMPS=true
# Timestamp format (iso, unix, human)
TIMESTAMP_FORMAT=iso
# Track user actions for auditability
TRACK_PII_ACTIONS=true
TRACK_BLOCK_EDITS=true
TRACK_THEME_CHANGES=true
# Audit log retention (days)
AUDIT_LOG_RETENTION_DAYS=90

# =============================================
# MCP (Model Context Protocol) Settings
# =============================================
# Enable MCP server for AI tool integration
ENABLE_MCP_SERVER=true
MCP_SERVER_HOST=localhost
MCP_SERVER_PORT=8001
# MCP transport type (stdio, sse, websocket)
MCP_TRANSPORT=sse
# MCP tools to expose
MCP_ENABLED_TOOLS=pdf_extract,pii_detect,markdown_build,semantic_analyze,html_generate
# MCP authentication (optional)
MCP_AUTH_ENABLED=false
MCP_AUTH_TOKEN=your-mcp-auth-token

# ----- Lightweight UI Settings (Streamlit/Gradio) -----
# UI framework to use (streamlit, gradio)
UI_FRAMEWORK=streamlit
STREAMLIT_PORT=8501
GRADIO_PORT=7860
# Enable live preview in Co-Design
ENABLE_LIVE_PREVIEW=true
# Auto-refresh interval (seconds)
PREVIEW_REFRESH_INTERVAL=2

# ----- WebSocket Settings (Real-time Updates) -----
ENABLE_WEBSOCKET=true
WEBSOCKET_PORT=8002
WEBSOCKET_PING_INTERVAL=30

# ----- Caching Settings -----
ENABLE_CACHE=true
CACHE_TYPE=memory
CACHE_TTL_SECONDS=3600
CACHE_MAX_SIZE=1000

# ----- Background Task Settings -----
ENABLE_BACKGROUND_TASKS=true
# Use 'memory' for lightweight, 'redis' for production
TASK_BROKER=memory
REDIS_URL=redis://localhost:6379/0

# ----- Lightweight Database Settings -----
# Database type (tinydb for lightweight, sqlite for production)
DB_TYPE=tinydb
DB_PATH=./data/pdf2web.db
# SQLite connection (if DB_TYPE=sqlite)
SQLITE_URL=sqlite:///./data/pdf2web.sqlite

# ----- Progress Tracking -----
ENABLE_PROGRESS_TRACKING=true
PROGRESS_UPDATE_INTERVAL=0.5

# =============================================
# Interactive Components (Semantic Injection)
# =============================================
# Chart.js Settings
CHART_DEFAULT_WIDTH=600
CHART_DEFAULT_HEIGHT=400
CHART_ANIMATION_ENABLED=true
CHART_RESPONSIVE=true
CHART_COLORS=4e79a7,f28e2c,e15759,76b7b2,59a14f,edc949,af7aa1,ff9da7,9c755f,bab0ab

# Quiz Widget Settings
QUIZ_SHOW_FEEDBACK=true
QUIZ_ALLOW_RETRY=true
QUIZ_SHUFFLE_OPTIONS=false

# Code Block Settings
CODE_THEME=prism
CODE_LINE_NUMBERS=true
CODE_COPY_BUTTON=true
CODE_MAX_HEIGHT=500

# Timeline Widget Settings (Plugin)
ENABLE_TIMELINE_WIDGET=true
TIMELINE_DEFAULT_STYLE=horizontal

# Map Widget Settings (Plugin)
ENABLE_MAP_WIDGET=true
MAP_DEFAULT_PROVIDER=openstreetmap

# =============================================
# Accessibility Settings
# =============================================
ENABLE_ACCESSIBILITY_CHECKS=true
# WCAG compliance level (A, AA, AAA)
WCAG_LEVEL=AA
# Generate ARIA labels automatically
AUTO_ARIA_LABELS=true
# High contrast mode support
SUPPORT_HIGH_CONTRAST=true
# Screen reader optimizations
SCREEN_READER_OPTIMIZED=true
# Keyboard navigation support
KEYBOARD_NAVIGATION=true
# Skip links for navigation
ENABLE_SKIP_LINKS=true

# =============================================
# Internationalization (i18n) Settings
# =============================================
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,zh,es,fr,de,ja,ko
# Auto-detect document language
AUTO_DETECT_LANGUAGE=true
# RTL (Right-to-Left) support
SUPPORT_RTL=true

# =============================================
# Document Processing Enhancements
# =============================================
# Table extraction method (paddleocr, tabula, camelot)
TABLE_EXTRACTION_METHOD=paddleocr
# Enable table structure detection
ENABLE_TABLE_STRUCTURE=true
# PDF metadata extraction
EXTRACT_PDF_METADATA=true
# Document structure analysis
ENABLE_LAYOUT_ANALYSIS=true
# Heading level detection
AUTO_HEADING_LEVELS=true
# List detection and formatting
AUTO_LIST_DETECTION=true

# =============================================
# Theme Settings
# =============================================
# Available themes
AVAILABLE_THEMES=light,dark,professional,academic,minimal
# Default theme
DEFAULT_THEME=light
# Allow custom CSS injection
ALLOW_CUSTOM_CSS=true
# Theme preview in Co-Design
ENABLE_THEME_PREVIEW=true

# =============================================
# Output HTML Settings
# =============================================
# HTML minification
MINIFY_HTML=false
# Inline CSS (vs external stylesheet)
INLINE_CSS=true
# Include viewport meta tag
INCLUDE_VIEWPORT_META=true
# Responsive breakpoints
RESPONSIVE_BREAKPOINTS=768,1024,1200
# Print stylesheet
INCLUDE_PRINT_STYLES=true

# =============================================
# Image Handling Settings
# =============================================
# Image compression quality (1-100)
IMAGE_QUALITY=85
# Max image dimension (pixels)
MAX_IMAGE_DIMENSION=2000
# Image format for output (original, webp, png, jpg)
OUTPUT_IMAGE_FORMAT=original
# Lazy loading for images
ENABLE_LAZY_LOADING=true
# Generate image alt text (via ERNIE)
AUTO_ALT_TEXT=true

# =============================================
# Performance Settings
# =============================================
# Concurrent OCR pages
OCR_CONCURRENT_PAGES=4
# ERNIE API retry attempts
ERNIE_RETRY_ATTEMPTS=3
# ERNIE API retry delay (seconds)
ERNIE_RETRY_DELAY=1
# Max concurrent document processing
MAX_CONCURRENT_DOCUMENTS=5
# Memory limit per document (MB)
MEMORY_LIMIT_PER_DOC=512
